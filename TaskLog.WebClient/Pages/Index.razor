@page "/"
@inject DataService DataService
@implements IDisposable

<div class="job-side-nav">
    <div class="job-container">
        @foreach (var job in Jobs)
        {
            <JobView Job="job"></JobView>
        }
    </div>
</div>

@*<TaskWeekView>*@
    <div class="task-week-container">
        <TaskDayView DayDate="@DateTime.Now.AddDays(-2).ToShortDateString()" />
        <TaskDayView DayDate="@DateTime.Now.AddDays(-1).ToShortDateString()" />
        <TaskDayView DayDate="@DateTime.Now.ToShortDateString()" />
        <TaskDayView DayDate="@DateTime.Now.AddDays(1).ToShortDateString()" />
    <TaskDayView DayDate="@DateTime.Now.AddDays(2).ToShortDateString()" />
    </div>
@*</TaskWeekView>*@

<button class="float-btn" type="button" @onclick="DataService.AddNewTask"><i class="oi oi-plus" /></button>

<RemoveTaskDropZone />

@code {
    List<JobTask> Tasks { get; set; }
    List<ProjectJob> Jobs { get; set; }

    protected override void OnInitialized()
    {
        DataService.LoadJobs();
        DataService.LoadTasks();
        Jobs = DataService.Jobs.ToList();
        Tasks = DataService.Tasks.ToList();
        DataService.OnDataChanged += HandleDateChanged;
    }

    void HandleDateChanged()
    {
        StateHasChanged();
    }

    public void Dispose()
    {
        DataService.OnDataChanged -= HandleDateChanged;
    }
}
