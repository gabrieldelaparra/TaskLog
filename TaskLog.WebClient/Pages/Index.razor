@page "/"
@inject WeatherForecastService ForecastService

<style>
    .sidenav {
        height: 100%;
        width: 160px;
        position: fixed;
        z-index: 0;
        top: 0;
        left: 0;
        overflow-x: hidden;
        padding-top: 20px;
    }

    .job-container {
        display: flex;
        justify-content: space-around;
        flex-direction: column;
        width: 160px;
    }
</style>

<div class="sidenav">
    <div class="job-container">
        @foreach (var job in Jobs)
        {
            <JobView Job="job"></JobView>
        }
    </div>
</div>

<TaskWeekView Tasks="Tasks" OnDateChanged="HandleDateChanged">
    <TaskDayView DayDate="@DateTime.Now.AddDays(-2).ToShortDateString()" />
    <TaskDayView DayDate="@DateTime.Now.AddDays(-1).ToShortDateString()" />
    <TaskDayView DayDate="@DateTime.Now.ToShortDateString()" />
    <TaskDayView DayDate="@DateTime.Now.AddDays(1).ToShortDateString()" />
    <TaskDayView DayDate="@DateTime.Now.AddDays(2).ToShortDateString()" />
</TaskWeekView>

@code {
    List<JobTask> Tasks { get; set; }
    List<ProjectJob> Jobs { get; set; }

    protected override void OnInitialized()
    {
        Jobs = WeatherForecastService.Jobs.ToList();
        Tasks = WeatherForecastService.Tasks.ToList();
    }

    void HandleDateChanged(JobTask jobTask)
    {
        WeatherForecastService.SaveTasks(Tasks.ToArray());
    }
}
